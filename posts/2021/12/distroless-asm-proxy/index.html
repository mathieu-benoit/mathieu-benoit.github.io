<!doctype html><html lang=en><head><title>distroless asm proxy ::
always up, always on</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Anthos Service Mesh (ASM) 1.12 now supports deploying a proxy built on the distroless base image.
The distroless base image ensures that the proxy image contains the minimal number of packages required to run the proxy. This improves security posture by reducing the overall attack surface of the image and gets cleaner results with CVE scanners.
Here is in action how you could leverage the distroless base image while installing ASM:"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://mathieu-benoit.github.io/myblog/posts/2021/12/distroless-asm-proxy/><link rel=stylesheet href=https://mathieu-benoit.github.io/myblog/assets/style.css><link rel=stylesheet href=https://mathieu-benoit.github.io/myblog/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://mathieu-benoit.github.io/myblog/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://mathieu-benoit.github.io/myblog/img/favicon.png><link href=https://mathieu-benoit.github.io/myblog/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://mathieu-benoit.github.io/myblog/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://mathieu-benoit.github.io/myblog/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://mathieu-benoit.github.io/myblog/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://mathieu-benoit.github.io/myblog/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://mathieu-benoit.github.io/myblog/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary"><meta name=twitter:title content="distroless asm proxy"><meta name=twitter:description content="let's see how to improve our security feature by leveraging the distroless asm proxy image"><meta property="og:title" content="distroless asm proxy"><meta property="og:description" content="let's see how to improve our security feature by leveraging the distroless asm proxy image"><meta property="og:type" content="article"><meta property="og:url" content="https://mathieu-benoit.github.io/myblog/posts/2021/12/distroless-asm-proxy/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-12-13T00:00:00+00:00"><meta property="article:modified_time" content="2021-12-13T00:00:00+00:00"><meta property="og:site_name" content="always up, always on"><script async src="https://www.googletagmanager.com/gtag/js?id=G-J8536XT21V"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-J8536XT21V",{anonymize_ip:!1})}</script></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>always up, always on</span>
<span class=logo__cursor></span></a>
<span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/myblog/about/>about</a></li><li><a href=/myblog/presentations/>presentations</a></li><li><a href=/myblog/tags/>tags</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/myblog/about/>about</a></li><li><a href=/myblog/presentations/>presentations</a></li><li><a href=/myblog/tags/>tags</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h1 class=post-title>distroless asm proxy</h1><div class=post-meta><span class=post-date>2021-12-13</span></div><span class=post-tags><a href=https://mathieu-benoit.github.io/myblog/tags/gcp/>#gcp</a>&nbsp;
<a href=https://mathieu-benoit.github.io/myblog/tags/security/>#security</a>&nbsp;
<a href=https://mathieu-benoit.github.io/myblog/tags/kubernetes/>#kubernetes</a>&nbsp;
<a href=https://mathieu-benoit.github.io/myblog/tags/service-mesh/>#service-mesh</a>&nbsp;
<a href=https://mathieu-benoit.github.io/myblog/tags/containers/>#containers</a>&nbsp;</span><div class=post-content><p><a href=https://cloud.google.com/service-mesh/docs/release-notes#December_09_2021>Anthos Service Mesh (ASM) 1.12</a> now supports deploying a proxy built on the <a href=https://istio.io/latest/docs/ops/configuration/security/harden-docker-images/>distroless base image</a>.</p><blockquote><p>The distroless base image ensures that the proxy image contains the minimal number of packages required to run the proxy. This improves security posture by reducing the overall attack surface of the image and gets cleaner results with CVE scanners.</p></blockquote><p>Here is in action how you could <a href=https://cloud.google.com/service-mesh/docs/unified-install/options/enable-optional-features#distroless_proxy_image>leverage the distroless base image while installing ASM</a>:</p><pre tabindex=0><code>curl https://storage.googleapis.com/csm-artifacts/asm/asmcli_1.12 &gt; ~/asmcli
chmod +x ~/asmcli
cat &lt;&lt;EOF &gt; distroless-proxy.yaml
---
apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
spec:
  meshConfig:
    defaultConfig:
      image:
        imageType: distroless
EOF
~/asmcli install \
    --project_id $projectId \
    --cluster_name $clusterName \
    --cluster_location $zone \
    --enable-all \
    --custom_overlay distroless-proxy.yaml
</code></pre><p>Then when you will inject the istio-proxy sidecar, it will use the distroless image.</p><p>If we look a little bit closer to the container images, we could see that we save 82MB with the distroless image:</p><pre tabindex=0><code>REPOSITORY                       TAG                       SIZE
gcr.io/gke-release/asm/proxyv2   1.12.0-asm.3-distroless   173MB
gcr.io/gke-release/asm/proxyv2   1.12.0-asm.3              255MB
</code></pre><p>Furthermore, if we do a <a href=https://mathieu-benoit.github.io/myblog/posts/2021/09/container-scanning/>container scanning</a>, we could see that the distroless image has only 9 vulnerabilities as opposed to 26 for non-distroless.</p><p>Quite good news, isn&rsquo;t it!?</p><p><em>Note: <a href=https://cloud.google.com/service-mesh/docs/gateways>when deploying your own gateways</a>, you may end up with <code>error envoy config listener '0.0.0.0_80' failed to bind or apply socket options: cannot bind '0.0.0.0:80': Permission denied</code>. That&rsquo;s because the distroless image runs as non root. You need to set explicit <code>targetPort</code> for the gateways&rsquo;s <code>Service</code> with <code>8080</code> or <code>8443</code> for example.</em></p><p>Hope you enjoyed that one to improve your security posture, stay safe out there! ;)</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://mathieu-benoit.github.io/myblog/posts/2021/12/log4shell/><span class=button__icon>←</span>
<span class=button__text>lessons learned from the log4shell cves</span></a></span>
<span class="button next"><a href=https://mathieu-benoit.github.io/myblog/posts/2021/12/crfa-v2/><span class=button__text>crfa v2 with asm</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>always up, always on</span>
<span class=logo__cursor></span></a><div class=copyright><span>© 2023 Powered by
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span>
<span>Theme created by
<a href=https://twitter.com/panr target=_blank rel=noopener>panr</a></span></div></div></footer><script src=https://mathieu-benoit.github.io/myblog/assets/main.js></script>
<script src=https://mathieu-benoit.github.io/myblog/assets/prism.js></script></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-J8536XT21V"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-J8536XT21V",{anonymize_ip:!1})}</script></body></html>