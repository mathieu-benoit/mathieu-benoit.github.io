<!doctype html><html lang=en><head><title>gke cos version ::
always up, always on</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="One of the best practices for your Security posture with GKE is to use a cos-containerd image type for your GKE nodes.
Based on Chromium OS, Container-Optimized OS from Google implements several security design principles to provide a well-configured platform for running production services.
The containerd runtime is considered more resource efficient and secure when compared to the Docker runtime.
Recently, I was curious to know the versions of containerd and COS of my GKE nodes."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=mathieu-benoit.github.io/posts/2021/09/gke-cos-version/><link rel=stylesheet href=mathieu-benoit.github.io/assets/style.css><link rel=stylesheet href=mathieu-benoit.github.io/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=mathieu-benoit.github.io/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=mathieu-benoit.github.io/img/favicon.png><link href=mathieu-benoit.github.io/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=mathieu-benoit.github.io/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=mathieu-benoit.github.io/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=mathieu-benoit.github.io/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=mathieu-benoit.github.io/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=mathieu-benoit.github.io/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary"><meta name=twitter:title content="gke cos version"><meta name=twitter:description content="let's see how to get the cos version of your gke nodes"><meta property="og:title" content="gke cos version"><meta property="og:description" content="let's see how to get the cos version of your gke nodes"><meta property="og:type" content="article"><meta property="og:url" content="mathieu-benoit.github.io/posts/2021/09/gke-cos-version/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-09-21T00:00:00+00:00"><meta property="article:modified_time" content="2021-09-21T00:00:00+00:00"><meta property="og:site_name" content="always up, always on"><script async src="https://www.googletagmanager.com/gtag/js?id=G-J8536XT21V"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-J8536XT21V",{anonymize_ip:!1})}</script></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>always up, always on</span>
<span class=logo__cursor></span></a>
<span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=mathieu-benoit.github.io/about/>about</a></li><li><a href=mathieu-benoit.github.io/presentations/>presentations</a></li><li><a href=mathieu-benoit.github.io/tags/>tags</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=mathieu-benoit.github.io/about/>about</a></li><li><a href=mathieu-benoit.github.io/presentations/>presentations</a></li><li><a href=mathieu-benoit.github.io/tags/>tags</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h1 class=post-title>gke cos version</h1><div class=post-meta><span class=post-date>2021-09-21</span></div><span class=post-tags><a href=mathieu-benoit.github.io/tags/gcp/>#gcp</a>&nbsp;
<a href=mathieu-benoit.github.io/tags/kubernetes/>#kubernetes</a>&nbsp;
<a href=mathieu-benoit.github.io/tags/security/>#security</a>&nbsp;</span><div class=post-content><p>One of the best practices for your Security posture with GKE is to use a <code>cos-containerd</code> image type for your GKE nodes.</p><blockquote><p>Based on Chromium OS, <a href=https://cloud.google.com/container-optimized-os/docs/concepts/security>Container-Optimized OS</a> from Google implements several security design principles to provide a well-configured platform for running production services.</p></blockquote><blockquote><p>The <a href=https://cloud.google.com/kubernetes-engine/docs/concepts/using-containerd><code>containerd</code></a> runtime is considered more resource efficient and secure when compared to the <code>Docker</code> runtime.</p></blockquote><p>Recently, I was curious to know the versions of <code>containerd</code> and <code>COS</code> of my GKE nodes. Let&rsquo;s see how we could get these information.</p><p>Let&rsquo;s create a new dedicated cluster as the setup for the following command lines throughout this blog article:</p><pre tabindex=0><code>zone=us-east4-a
clusterName=test-cos-versions
gcloud container clusters create $clusterName \
    --zone=$zone \
    --image-type cos_containerd \
    --release-channel stable \
    --num-nodes 2
</code></pre><p>We created a GKE cluster in the <code>stable</code> channel. <code>kubectl get nodes -o wide</code> gives the following information:</p><pre tabindex=0><code>VERSION           KERNEL-VERSION   CONTAINER-RUNTIME
v1.19.12-gke.2101 5.4.109+         containerd://1.4.3
</code></pre><p>We know that we are with the <code>5.4.109+</code> of the COS&rsquo;s <code>KERNEL-VERSION</code> and <code>1.4.3</code> of <code>containerd</code>. By using the default version of the channel, we could find the information about which specific version of COS we are using from <a href=https://cloud.google.com/kubernetes-engine/docs/release-notes#current_versions>here</a>: <a href=https://cloud.google.com/container-optimized-os/docs/release-notes/m85#cos-85-13310-1308-1><code>cos-85-13310-1308-1</code></a> (dated from Jul 12, 2021 for <code>COS 85</code>).</p><p>Now let&rsquo;s update our cluster to the next version available in the <code>stable</code> channel and see what we&rsquo;ll have with this new version:</p><pre tabindex=0><code>newVersion=1.19.13-gke.701 # latest version for the stable channel when I wrote this blog
gcloud container clusters upgrade $clusterName --master \
    --zone $zone \
    --cluster-version $newVersion \
    --quiet
gcloud container clusters upgrade $clusterName \
    --zone $zone \
    --quiet
</code></pre><p><code>kubectl get nodes -o wide</code> now gives the following information:</p><pre tabindex=0><code>VERSION           KERNEL-VERSION   CONTAINER-RUNTIME
1.19.13-gke.701   5.4.129+         containerd://1.4.6
</code></pre><p>Let&rsquo;s check the exact COS version by running this ephemeral container (or you could <code>ssh</code> to the GCE):</p><pre tabindex=0><code>node=$(kubectl get nodes -o jsonpath=&#39;{.items[0].metadata.name}&#39;)
kubectl debug -it node/$node --image=busybox -- cat /host/etc/os-release
</code></pre><p>We could see that the version is now <a href=https://cloud.google.com/container-optimized-os/docs/release-notes/m85#cos-85-13310-1308-1><code>cos-85-13310.1308.1</code></a> (dated from Jul 12, 2021 for <code>COS 85</code>).</p><p>Now let&rsquo;s update our cluster to the next channel <code>regular</code> and see what we&rsquo;ll have with this new version:</p><pre tabindex=0><code># Change the release channel:
gcloud container clusters update $clusterName \
    --zone $zone \
    --release-channel regular
# Update the controlplane first with the default version of the new release channel:
gcloud container clusters upgrade $clusterName \
    --zone $zone \
    --master \
    --quiet
# Update nodepools to align the controlplane:
gcloud container clusters upgrade $clusterName \
    --zone $zone \
    --quiet
</code></pre><p>From there we could repeat the previous command lines in order to get the <code>containerd</code> and the COS versions for the different GKE versions. As the result, the table below will summarize the different versions found for the three channels: <code>stable</code>, <code>regular</code> and <code>rapid</code>:</p><table><thead><tr><th>Channel</th><th>Kubernetes</th><th>Kernel</th><th>COS</th><th>containerd</th></tr></thead><tbody><tr><td>stable</td><td>1.19.12-gke.2101</td><td>5.4.109</td><td><a href=https://cloud.google.com/container-optimized-os/docs/release-notes/m85#cos-85-13310-1308-1>cos-85-13310-1308-1</a></td><td>1.4.3</td></tr><tr><td>stable</td><td>1.19.13-gke.701</td><td>5.4.129</td><td><a href=https://cloud.google.com/container-optimized-os/docs/release-notes/m85#cos-85-13310-1308-1>cos-85-13310.1308.1</a></td><td>1.4.6</td></tr><tr><td>regular</td><td>1.20.9-gke.701</td><td>5.4.120</td><td><a href=https://cloud.google.com/container-optimized-os/docs/release-notes/m89#cos-89-16108-470-1>cos-89-16108.470.1</a></td><td>1.4.4</td></tr><tr><td>regular</td><td>1.20.9-gke.1001</td><td>5.4.120</td><td><a href=https://cloud.google.com/container-optimized-os/docs/release-notes/m89#cos-89-16108-470-1>cos-89-16108.470.1</a></td><td>1.4.4</td></tr><tr><td>rapid</td><td>1.21.3-gke.2001</td><td>5.4.120</td><td><a href=https://cloud.google.com/container-optimized-os/docs/release-notes/m89#cos-89-16108-470-11>cos-89-16108.470.11</a></td><td>1.4.4</td></tr><tr><td>rapid</td><td>1.21.4-gke.301</td><td>5.4.120</td><td><a href=https://cloud.google.com/container-optimized-os/docs/release-notes/m89#cos-89-16108-470-11>cos-89-16108.470.11</a></td><td>1.4.4</td></tr></tbody></table><p>Here are few statements (which will change in the future since updates for GKE or COS happen every week):</p><ul><li>COS doesn&rsquo;t have latest <code>containerd</code> version, we see <code>1.4.3</code>, <code>1.4.4</code> or <code>1.4.6</code> as opposed to latest today <code>1.4.9</code> or <code>1.5.5</code></li><li>GKE doesn&rsquo;t have the latest COS version, <code>85-13310-1308-1</code>, <code>89-16108.470.1</code> or <code>89-16108.470.11</code> as opposed to latest or lts <code>89-16108-534-2</code> (<code>gcloud compute images list --project cos-cloud --no-standard-images</code>)</li></ul><p>Is it an issue? Not at all! Because GKE integrates well tested and stable COS images and provide guidance with its <a href=https://cloud.google.com/anthos/clusters/docs/security-bulletins>security bulletins</a> when necessary.</p><p>Is it something to keep in mind? Yes for sure!</p><p>Notes:</p><ul><li>On 2022-04-08, GKE got the version 1.23.5-gke.200 with associated <code>COS 93</code> version <a href=https://cloud.google.com/container-optimized-os/docs/release-notes/m93#cos-93-16623-102-23><code>cos-93-16623-102-23</code></a> and <code>COS Kernel</code> version <code>5.10.90</code></li><li>On 2022-03-02, GKE got the version 1.23.3-gke.1100 with associated <code>COS 93</code> version <a href=https://cloud.google.com/container-optimized-os/docs/release-notes/m93#cos-93-16623-102-5><code>cos-93-16623-102-5</code></a> and <code>COS Kernel</code> version <code>5.10.90</code>
cos-93-16623-102-5</li><li>On 2022-01-28, GKE got the version 1.22.4-gke.1501 with associated <code>COS 93</code> version <a href=https://cloud.google.com/container-optimized-os/docs/release-notes/m93#cos-93-16623-39-28><code>cos-93-16623-39-28</code></a></li><li>On 2021-12-06, GKE got the version 1.22.3-gke.1500 with associated <code>COS 93</code> version <a href=https://cloud.google.com/container-optimized-os/docs/release-notes/m93#cos-93-16623-39-13><code>cos-93-16623-39-13</code></a></li><li>On 2021-11-15, GKE got the version 1.22.3-gke.700 with associated <code>containerd</code> version <code>1.5.4</code>, <code>COS 93</code> version <a href=https://cloud.google.com/container-optimized-os/docs/release-notes/m93#cos-93-16623-39-6><code>cos-93-16623-39-6</code></a> and <code>COS Kernel</code> version <code>5.10.68</code></li></ul><p>When dealing with a manged Kubernetes service, in this case GKE, there is a <a href=https://cloud.google.com/blog/products/containers-kubernetes/exploring-container-security-the-shared-responsibility-model-in-gke-container-security-shared-responsibility-model-gke>shared responsibilities model</a> to have in mind. And one of them is to make sure your GKE cluster is up-to-date, <a href=https://cloud.google.com/kubernetes-engine/docs/how-to/node-auto-upgrades>node auto-upgrade</a> to the rescue! Node auto-upgrade is upgrading your cluster to the new default version of channel of your GKE cluster. You may also want in some cases to <a href=https://cloud.google.com/kubernetes-engine/docs/how-to/upgrading-a-cluster>manually update your cluster</a> to the latest version in that channel.</p><p>In addition to by <a href=https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#secure_defaults>default secured features enabled</a>, here is also couple of features you could leverage in order to mitigate let&rsquo;s say a known CVE on your GKE nodes:</p><ul><li><a href=https://cloud.google.com/kubernetes-engine/docs/how-to/private-clusters>Private GKE clusters</a></li><li><a href=mathieu-benoit.github.io/posts/2021/03/policy-controller/>Policy controller (OPA Gatekeeper)</a></li><li><a href=mathieu-benoit.github.io/posts/2020/11/binauthz/>Binary Authorization</a></li><li><a href=https://cloud.google.com/security-command-center/docs/concepts-container-threat-detection-overview>Container Threat detection with SCC</a></li><li>and many more!</li></ul><p>Complementary and further resources:</p><ul><li><a href=https://github.com/containerd/containerd/releases><code>containerd</code> releases</a></li><li><a href=https://cloud.google.com/kubernetes-engine/docs/release-schedule>GKE release schedule</a></li><li><a href=https://cloud.google.com/container-optimized-os/docs/release-notes>Container-Optimized OS Release Notes</a></li><li><a href=https://cloud.google.com/container-optimized-os/docs/concepts/versioning#lts_refresh_releases>COS LTS Refresh releases</a></li><li><a href=https://cloud.google.com/kubernetes-engine/docs/release-notes>GKE Release notes</a></li><li><a href=https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster>Hardening your cluster&rsquo;s security</a></li></ul><p>Hope you enjoyed that one, stay safe out there, cheers!</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=mathieu-benoit.github.io/posts/2021/11/asm-security/><span class=button__icon>←</span>
<span class=button__text>secure your apps and your cluster with anthos service mesh</span></a></span>
<span class="button next"><a href=mathieu-benoit.github.io/posts/2021/09/container-scanning/><span class=button__text>container scanning</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>always up, always on</span>
<span class=logo__cursor></span></a><div class=copyright><span>© 2023 Powered by
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span>
<span>Theme created by
<a href=https://twitter.com/panr target=_blank rel=noopener>panr</a></span></div></div></footer><script src=mathieu-benoit.github.io/assets/main.js></script>
<script src=mathieu-benoit.github.io/assets/prism.js></script></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-J8536XT21V"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-J8536XT21V",{anonymize_ip:!1})}</script></body></html>