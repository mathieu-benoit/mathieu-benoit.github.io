<!doctype html><html lang=en><head><title>vertical pod autoscaler ::
always up, always on</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="With applications running on Kubernetes it&amp;rsquo;s important to properly set the CPU resources and Memory resources. But it could be hard to find and choose the proper values for cpu and memory.
Resource request is a contract between your workload and the Kubernetes scheduler.
Using monitoring tools with Kubernetes clusters for getting insights about the usage of cpu and memory of application could help. Complementary to this, kubectl top pods to get more insights may help too."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://mathieu-benoit.github.io/myblog/posts/2021/01/vpa/><link rel=stylesheet href=https://mathieu-benoit.github.io/myblog/assets/style.css><link rel=stylesheet href=https://mathieu-benoit.github.io/myblog/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://mathieu-benoit.github.io/myblog/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://mathieu-benoit.github.io/myblog/img/favicon.png><link href=https://mathieu-benoit.github.io/myblog/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://mathieu-benoit.github.io/myblog/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://mathieu-benoit.github.io/myblog/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://mathieu-benoit.github.io/myblog/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://mathieu-benoit.github.io/myblog/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://mathieu-benoit.github.io/myblog/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary"><meta name=twitter:title content="vertical pod autoscaler"><meta name=twitter:description content="let's discuss about the vertical pod autoscaler and how it could help setting your Kubernetes resources request and limits."><meta property="og:title" content="vertical pod autoscaler"><meta property="og:description" content="let's discuss about the vertical pod autoscaler and how it could help setting your Kubernetes resources request and limits."><meta property="og:type" content="article"><meta property="og:url" content="https://mathieu-benoit.github.io/myblog/posts/2021/01/vpa/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-01-04T00:00:00+00:00"><meta property="article:modified_time" content="2021-01-04T00:00:00+00:00"><meta property="og:site_name" content="always up, always on"><script async src="https://www.googletagmanager.com/gtag/js?id=G-J8536XT21V"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-J8536XT21V",{anonymize_ip:!1})}</script></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>always up, always on</span>
<span class=logo__cursor></span></a>
<span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/myblog/about/>about</a></li><li><a href=/myblog/presentations/>presentations</a></li><li><a href=/myblog/tags/>tags</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/myblog/about/>about</a></li><li><a href=/myblog/presentations/>presentations</a></li><li><a href=/myblog/tags/>tags</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h1 class=post-title>vertical pod autoscaler</h1><div class=post-meta><span class=post-date>2021-01-04</span></div><span class=post-tags><a href=https://mathieu-benoit.github.io/myblog/tags/gcp/>#gcp</a>&nbsp;
<a href=https://mathieu-benoit.github.io/myblog/tags/kubernetes/>#kubernetes</a>&nbsp;</span><div class=post-content><p>With applications running on Kubernetes it&rsquo;s important to properly set the <a href=https://kubernetes.io/docs/tasks/configure-pod-container/assign-cpu-resource/>CPU resources</a> and <a href=https://kubernetes.io/docs/tasks/configure-pod-container/assign-memory-resource/>Memory resources</a>. But it could be hard to find and choose the proper values for <code>cpu</code> and <code>memory</code>.</p><blockquote><p>Resource request is a contract between your workload and the Kubernetes scheduler.</p></blockquote><p>Using <a href=https://mathieu-benoit.github.io/myblog/posts/2020/08/cloud-operations-with-gke/>monitoring tools with Kubernetes clusters</a> for getting insights about the usage of <code>cpu</code> and <code>memory</code> of application could help. Complementary to this, <code>kubectl top pods</code> to get more insights may help too. In the meantime, you could run load tests and simulate more usage of your applications, the more close to what you could have in Production with high traffic, the better.</p><p>I recently discovered that <a href=https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler>Vertical Pod Autoscaler</a> is better at it since that&rsquo;s its job.</p><blockquote><p>Setting resource request and limit is hard, VPA is here to help. Observes usage, Recommends resources and Updates resources (if <code>Auto</code> mode).</p></blockquote><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/Y4vnYaqhS74 style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="Rightsize Your Pods with Vertical Pod Autoscaling - Beata Skiba, Google"></iframe></div><p>Let&rsquo;s now see in actions how easy it is to leverage <a href=https://cloud.google.com/kubernetes-engine/docs/how-to/vertical-pod-autoscaling>VPA on a GKE cluster</a>.</p><p>First enable VPA:</p><pre tabindex=0><code># For a new cluster
gcloud container clusters create --enable-vertical-pod-autoscaling

# For an existing cluster
gcloud container clusters update --enable-vertical-pod-autoscaling
</code></pre><p>Then deploy a VPA resource for your specific application:</p><pre tabindex=0><code>apiVersion: autoscaling.k8s.io/v1
kind: VerticalPodAutoscaler
metadata:
  name: myblog
spec:
  targetRef:
    apiVersion: &#34;apps/v1&#34;
    kind: Deployment
    name: myblog
  updatePolicy:
    updateMode: &#34;Off&#34;
</code></pre><p>And finally, after some time and load tests with your applications, you could discover those metrics by running <code>kubectl describe vpa myblog</code>:</p><pre tabindex=0><code>...
Recommendation:
    Container Recommendations:
      Container Name:  myblog
      Lower Bound:
        Cpu:     3m
        Memory:  4194304
      Target:
        Cpu:     6m
        Memory:  5242880
      Uncapped Target:
        Cpu:     6m
        Memory:  5242880
      Upper Bound:
        Cpu:     6m
        Memory:  5242880
...
</code></pre><p>In this illustration, I&rsquo;m using the <code>updateMode: "Off"</code>, with that I need to manually apply those numbers on my <code>Deployment</code> manifest. <code>Lower Bound</code> could be used to set the <code>requests</code> numbers (but you may want to use <code>Target</code> to be more conservative). <code>Upper Bound</code> could be used to set the <code>limits</code> numbers. So with the numbers gotten above, here is what the <code>Deployment</code> manifest will look like to represent them:</p><pre tabindex=0><code>...
          resources:
            requests:
              cpu: 3m
              memory: 4Mi
            limits:
              cpu: 6m
              memory: 5Mi
...
</code></pre><p><em>Notes: those numbers could be applied automatically and continuously if you are using <code>updateMode: "Auto"</code> instead. Furthermore, there is also <a href=https://cloud.google.com/kubernetes-engine/docs/concepts/verticalpodautoscaler#limitations_for_vertical_pod_autoscaling>some known limitations with VPA</a> to be aware of.</em></p><p>Complementary and further resources:</p><ul><li><a href=https://cloud.google.com/kubernetes-engine/docs/concepts/verticalpodautoscaler>VPA on GKE</a></li><li><a href=https://youtu.be/7naCIxIaV1M>Autoscaling with GKE: Overview and pods</a></li><li><a href=https://cloud.google.com/solutions/best-practices-for-running-cost-effective-kubernetes-applications-on-gke#vertical_pod_autoscaler>Best practices for running cost-optimized Kubernetes applications on GKE</a></li><li><a href=https://www.cncf.io/blog/2019/10/29/kubernetes-autoscaling-101-cluster-autoscaler-horizontal-autoscaler-and-vertical-pod-autoscaler/>Kubernetes Autoscaling 101: Cluster Autoscaler, Horizontal Autoscaler, and Vertical Pod Autoscaler</a></li></ul><p>Hope you enjoyed that blog article and that you are now more equiped to properly set your Kubernetes resources request and limits for your own applications.</p><p>Cheers! ;)</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://mathieu-benoit.github.io/myblog/posts/2021/01/container-linter/><span class=button__icon>←</span>
<span class=button__text>container linter for compliances and security</span></a></span>
<span class="button next"><a href=https://mathieu-benoit.github.io/myblog/posts/2020/12/ci-for-k8s/><span class=button__text>advanced continuous integration pipeline for containers</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>always up, always on</span>
<span class=logo__cursor></span></a><div class=copyright><span>© 2023 Powered by
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span>
<span>Theme created by
<a href=https://twitter.com/panr target=_blank rel=noopener>panr</a></span></div></div></footer><script src=https://mathieu-benoit.github.io/myblog/assets/main.js></script>
<script src=https://mathieu-benoit.github.io/myblog/assets/prism.js></script></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-J8536XT21V"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-J8536XT21V",{anonymize_ip:!1})}</script></body></html>