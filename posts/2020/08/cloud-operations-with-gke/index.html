<!doctype html><html lang=en><head><title>cloud operations with gke ::
always up, always on</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Cloud Operations (formerly known as Stackdriver) helps to monitor, troubleshoot, and improve application performance on your Google Cloud environment. It&amp;rsquo;s a combination of different features such as Cloud Logging, Cloud Monitoring, Cloud Trace, Cloud Debugger and Cloud Profiler and many more.
So, where to start with your GKE cluster? Actually, that&amp;rsquo;s pretty easy and straight forward! Checkout this blog article about Using logging for your apps running on Kubernetes Engine."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://mathieu-benoit.github.io/myblog/posts/2020/08/cloud-operations-with-gke/><link rel=stylesheet href=https://mathieu-benoit.github.io/myblog/assets/style.css><link rel=stylesheet href=https://mathieu-benoit.github.io/myblog/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://mathieu-benoit.github.io/myblog/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://mathieu-benoit.github.io/myblog/img/favicon.png><link href=https://mathieu-benoit.github.io/myblog/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://mathieu-benoit.github.io/myblog/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://mathieu-benoit.github.io/myblog/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://mathieu-benoit.github.io/myblog/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://mathieu-benoit.github.io/myblog/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://mathieu-benoit.github.io/myblog/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary"><meta name=twitter:title content="cloud operations with gke"><meta name=twitter:description content="let's see how to leverage google cloud operations (aka stackdriver) with gke"><meta property="og:title" content="cloud operations with gke"><meta property="og:description" content="let's see how to leverage google cloud operations (aka stackdriver) with gke"><meta property="og:type" content="article"><meta property="og:url" content="https://mathieu-benoit.github.io/myblog/posts/2020/08/cloud-operations-with-gke/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-08-17T00:00:00+00:00"><meta property="article:modified_time" content="2020-08-17T00:00:00+00:00"><meta property="og:site_name" content="always up, always on"><script async src="https://www.googletagmanager.com/gtag/js?id=G-J8536XT21V"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-J8536XT21V",{anonymize_ip:!1})}</script></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>always up, always on</span>
<span class=logo__cursor></span></a>
<span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/myblog/about/>about</a></li><li><a href=/myblog/presentations/>presentations</a></li><li><a href=/myblog/tags/>tags</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/myblog/about/>about</a></li><li><a href=/myblog/presentations/>presentations</a></li><li><a href=/myblog/tags/>tags</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h1 class=post-title>cloud operations with gke</h1><div class=post-meta><span class=post-date>2020-08-17</span></div><span class=post-tags><a href=https://mathieu-benoit.github.io/myblog/tags/gcp/>#gcp</a>&nbsp;
<a href=https://mathieu-benoit.github.io/myblog/tags/sre/>#sre</a>&nbsp;
<a href=https://mathieu-benoit.github.io/myblog/tags/containers/>#containers</a>&nbsp;
<a href=https://mathieu-benoit.github.io/myblog/tags/kubernetes/>#kubernetes</a>&nbsp;</span><div class=post-content><p><img src=https://storage.googleapis.com/gweb-cloudblog-publish/images/google_sre.max-500x500.jpg alt="Illustration of the interactions between the main personas using Google Cloud Operations Suite: such as GCP users, Observability partners, SRE and developers."></p><p><a href=https://cloud.google.com/products/operations>Cloud Operations</a> (formerly known as Stackdriver) helps to monitor, troubleshoot, and improve application performance on your Google Cloud environment. It&rsquo;s a combination of different features such as Cloud Logging, Cloud Monitoring, Cloud Trace, Cloud Debugger and Cloud Profiler and <a href=https://cloud.google.com/products/operations#all-features>many more</a>.</p><p>So, where to start with your GKE cluster? Actually, that&rsquo;s pretty easy and straight forward! Checkout this blog article about <a href=https://cloud.google.com/blog/products/management-tools/using-logging-your-apps-running-kubernetes-engine>Using logging for your apps running on Kubernetes Engine</a>.</p><blockquote><p>Cloud Logging, and its companion tool Cloud Monitoring, are full featured products that are both deeply integrated into GKE. In this blog post, we’ll go over how logging works on GKE and some best practices for log collection. Then we’ll go over some common logging use cases, so you can make the most out of the extensive logging functionality built into GKE and Google Cloud Platform.</p></blockquote><p>By default, any GKE cluster is created with the option <code>--enable-stackdriver-kubernetes</code> and is provisioned with a pre-configured <a href=https://www.fluentd.org/>Fluentd</a>-based collector that forwards logs to Cloud Logging. From there you could <a href=https://cloud.google.com/stackdriver/docs/solutions/gke/observing>observe your GKE cluster with a pre-built GKE dashboard and GKE metrics</a>. You could also create custom metrics, custom dashboards and alerts based on your containers, services, nodes, etc.</p><p>Here below are few queries I was able to run and leverage via the <a href=https://cloud.google.com/logging/docs/view/logs-viewer-interface>Cloud Logging - Logs Viewer Interface</a> to get more insights about my GKE cluster, my containerized app deployed on GKE:</p><pre tabindex=0><code># Get deleted deployments:
resource.type=&#34;k8s_cluster&#34; 
resource.labels.location=&#34;us-east1-b&#34;
resource.labels.cluster_name=&#34;mygkecluster&#34; 
protoPayload.methodName=&#34;io.k8s.apps.v1.deployments.delete&#34;

# Get logs from myblog container:
resource.type=&#34;k8s_container&#34;
resource.labels.cluster_name=&#34;mygkecluster&#34;
resource.labels.namespace_name=&#34;default&#34;
resource.labels.container_name=&#34;myblog&#34;
</code></pre><p>And here below are few queries I was able to run to create custom charts and dashboards by leveraging <a href=https://cloud.google.com/monitoring/charts/metrics-explorer>Cloud Monitoring - Metrics Explorer</a>:</p><pre tabindex=0><code># Get container restart count:
metric.type=&#34;kubernetes.io/container/restart_count&#34; 
resource.type=&#34;k8s_container&#34;
metadata.user_labels.&#34;app.kubernetes.io/name&#34;=&#34;myblog&#34;

# Get container memory usage:
metric.type=&#34;kubernetes.io/container/memory/used_bytes&#34; 
resource.type=&#34;k8s_container&#34;
metadata.user_labels.&#34;app.kubernetes.io/name&#34;=&#34;myblog&#34;

# Get container CPU usage time:
metric.type=&#34;kubernetes.io/container/cpu/core_usage_time&#34;
resource.type=&#34;k8s_container&#34; 
metadata.user_labels.&#34;app.kubernetes.io/name&#34;=&#34;myblog&#34;

# Get container uptime:
metric.type=&#34;kubernetes.io/container/uptime&#34;
resource.type=&#34;k8s_container&#34;
metadata.user_labels.&#34;app.kubernetes.io/name&#34;=&#34;myblog&#34;
</code></pre><p>What&rsquo;s missing here is metrics around the HTTP requests on my containerized app, but fortunately I&rsquo;m able to get them via the <a href=https://cloud.google.com/load-balancing/docs/https/https-logging-monitoring>HTTP(S) Load Balancing Logging and Monitoring features</a>:</p><pre tabindex=0><code># Get total latency:
resource.type=&#34;https_lb_rule&#34;
resource.labels.url_map_name=&#34;k8s-um-default-myblog--33c1aa2f7a9fd258&#34;
resource.labels.project_id=&#34;mabenoit-myblog&#34;
metric.type=&#34;loadbalancing.googleapis.com/https/total_latencies&#34;

# Get requests count:
resource.type=&#34;https_lb_rule&#34;
resource.labels.url_map_name=&#34;k8s-um-default-myblog--33c1aa2f7a9fd258&#34;
resource.labels.project_id=&#34;mabenoit-myblog&#34;
metric.type=&#34;loadbalancing.googleapis.com/https/request_count&#34;
metric.labels.response_code_class!=&#34;0&#34;
</code></pre><p>Another feature I find very valuable is the <a href=https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring>concept of service monitoring combined with the SLO API</a>. I&rsquo;m able to <a href=https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring/microservices#gke-base-svc>get another pre-defined dashboard for my Kubernetes services</a> and actually from there <a href=https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring/ui/create-slo>I&rsquo;m now able to define some SLIs/SLOs</a>. To know more about SLO, I have found these resources below very insightful:</p><ul><li><a href=https://cloud.google.com/solutions/defining-SLOs>Defining SLOs</a></li><li><a href=https://cloud.google.com/solutions/adopting-SLOs>Adopting SLOs</a></li><li><a href=https://landing.google.com/sre/workbook/chapters/implementing-slos/>Implementing SLOs</a></li><li><a href=https://landing.google.com/sre/resources/practicesandprocesses/art-of-slos/>The Art of SLOs workshop</a></li></ul><blockquote><p>To determine if an SLO (Service Level Objective) is met/successful, you need a measurement. That measurement is called the SLI (Service Level Indicator). An SLI measures the level of a particular service that you&rsquo;re delivering to your customer. Ideally, the SLI is tied to an accepted CUJ (Critical User Journey).</p></blockquote><p>Have a look at how it&rsquo;s easy to <a href=https://youtu.be/wB9AKdPDv0Q>setup your SLOs for GKE services</a>:<div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/wB9AKdPDv0Q style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="SLOs for GKE services"></iframe></div></p><p>And that&rsquo;s it for now, like you could see how easy it is to leverage the Cloud Operations Suite with GKE to get visibility about your GKE cluster and the containerized apps you deployed in it with no code changes. So no excuses to not leverage this from day 0! ;)</p><p>Complementary resources:</p><ul><li><a href=https://landing.google.com/sre/books/>SRE books</a></li><li><a href="https://www.youtube.com/results?search_query=%23StackDoctor">StackDoctor on Youtube by Yuri Grinshteyn</a></li><li><a href=https://medium.com/google-cloud/setting-up-cloud-operations-for-gke-a21b49979693>Setting up Cloud Operations for GKE</a></li><li><a href=https://cloud.google.com/blog/products/management-tools/cloud-operations-suite-gets-21-new-features>21 new ways we&rsquo;re improving observability with Cloud Ops</a></li><li><a href=https://www.qwiklabs.com/quests/133>Qwiklabs - Google Cloud&rsquo;s Operations Suite on GKE</a></li><li><a href=https://medium.com/google-cloud/slos-with-stackdriver-service-monitoring-62f193147b3f>SLOs with Stackdriver Service Monitoring</a></li><li><a href=https://cloud.google.com/blog/products/management-tools/how-to-use-cloud-monitorings-dashboard-api-and-templates>New ways to manage custom Cloud Monitoring dashboards</a></li><li><a href=https://cloud.google.com/solutions/design-patterns-for-exporting-stackdriver-logging>Design patterns for exporting logging data</a></li></ul><p>Happy monitoring and happy sailing! ;)</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://mathieu-benoit.github.io/myblog/posts/2020/08/app-modernization-google-next-2020/><span class=button__icon>←</span>
<span class=button__text>application modernization at google next onair 2020</span></a></span>
<span class="button next"><a href=https://mathieu-benoit.github.io/myblog/posts/2020/08/cloud-build-with-gke/><span class=button__text>build and deploy a containerized app on gke with cloud build</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>always up, always on</span>
<span class=logo__cursor></span></a><div class=copyright><span>© 2023 Powered by
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span>
<span>Theme created by
<a href=https://twitter.com/panr target=_blank rel=noopener>panr</a></span></div></div></footer><script src=https://mathieu-benoit.github.io/myblog/assets/main.js></script>
<script src=https://mathieu-benoit.github.io/myblog/assets/prism.js></script></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-J8536XT21V"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-J8536XT21V",{anonymize_ip:!1})}</script></body></html>