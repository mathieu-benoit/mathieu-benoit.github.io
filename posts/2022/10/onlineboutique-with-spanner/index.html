<!doctype html><html lang=en><head><title>use google cloud spanner with the online boutique sample ::
always up, always on</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Update on Oct 18th, 2022: this blog article is now on Medium.
By default the cartservice of the Online Boutique sample stores its data in an in-cluster Redis database. Using a fully managed database service outside your GKE cluster such as Memorystore (Redis) could bring more resiliency and more security.
Since the recent v0.4.0 version, the Online Boutique sample can now store its data in Google Cloud Spanner.
Cloud Spanner is a fully managed relational database with unlimited scale, strong consistency, and up to 99."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://mathieu-benoit.github.io/posts/2022/10/onlineboutique-with-spanner/><link rel=stylesheet href=https://mathieu-benoit.github.io/assets/style.css><link rel=stylesheet href=https://mathieu-benoit.github.io/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://mathieu-benoit.github.io/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://mathieu-benoit.github.io/img/favicon.png><link href=https://mathieu-benoit.github.io/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://mathieu-benoit.github.io/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://mathieu-benoit.github.io/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://mathieu-benoit.github.io/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://mathieu-benoit.github.io/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://mathieu-benoit.github.io/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary"><meta name=twitter:title content="use google cloud spanner with the online boutique sample"><meta name=twitter:description content="let's see how to use google cloud spanner with the online boutique sample."><meta property="og:title" content="use google cloud spanner with the online boutique sample"><meta property="og:description" content="let's see how to use google cloud spanner with the online boutique sample."><meta property="og:type" content="article"><meta property="og:url" content="https://mathieu-benoit.github.io/posts/2022/10/onlineboutique-with-spanner/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-10-18T00:00:00+00:00"><meta property="article:modified_time" content="2022-10-18T00:00:00+00:00"><meta property="og:site_name" content="always up, always on"><script async src="https://www.googletagmanager.com/gtag/js?id=G-J8536XT21V"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-J8536XT21V",{anonymize_ip:!1})}</script></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>always up, always on</span>
<span class=logo__cursor></span></a>
<span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about/>about</a></li><li><a href=/presentations/>presentations</a></li><li><a href=/tags/>tags</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about/>about</a></li><li><a href=/presentations/>presentations</a></li><li><a href=/tags/>tags</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h1 class=post-title>use google cloud spanner with the online boutique sample</h1><div class=post-meta><span class=post-date>2022-10-18</span></div><span class=post-tags><a href=https://mathieu-benoit.github.io/tags/gcp/>#gcp</a>&nbsp;
<a href=https://mathieu-benoit.github.io/tags/kubernetes/>#kubernetes</a>&nbsp;</span><div class=post-content><p><em>Update on Oct 18th, 2022: this blog article is now on <a href=https://medium.com/google-cloud/f7248e077339>Medium</a>.</em></p><p>By default the <code>cartservice</code> of the Online Boutique sample stores its data in an in-cluster Redis database.
Using a fully managed database service outside your GKE cluster such as <a href=https://cloud.google.com/spanner>Memorystore (Redis)</a> could bring more resiliency and more security.</p><p>Since the recent <a href=https://github.com/GoogleCloudPlatform/microservices-demo/releases/tag/v0.4.0>v0.4.0 version</a>, the Online Boutique sample can now store its data in <a href=https://cloud.google.com/spanner>Google Cloud Spanner</a>.</p><blockquote><p>Cloud Spanner is a fully managed relational database with unlimited scale, strong consistency, and up to 99.999% availability.</p></blockquote><p>In this article, let&rsquo;s see how you can connect the Online Boutique sample to Google Cloud Spanner.</p><p><img src=https://github.com/mathieu-benoit/my-images/raw/main/onlineboutique-with-spanner.png alt="Architecture overview."></p><h2 id=objectives>Objectives
<a href=#objectives class=h-anchor aria-hidden=true>#</a></h2><ul><li>Create a Google Kubernetes Engine (GKE) cluster with Workload Identity</li><li>Provision a Spanner database with a <a href=https://cloud.google.com/blog/products/spanner/try-cloud-spanner-databases>free Spanner instance</a></li><li>Grant the <code>cartservice</code>&rsquo;s service account access to the Spanner database with a least privilege role assignment</li><li>Deploy the Online Boutique sample connected to the Spanner database with Kustomize</li></ul><h2 id=costs>Costs
<a href=#costs class=h-anchor aria-hidden=true>#</a></h2><p>This tutorial uses billable components of Google Cloud, including the following:</p><ul><li><a href=https://cloud.google.com/kubernetes-engine/pricing>Kubernetes Engine</a></li><li><a href=https://cloud.google.com/spanner/pricing>Spanner</a><ul><li>In this tutorial we will leverage the <a href=https://cloud.google.com/blog/products/spanner/try-cloud-spanner-databases>free Spanner instance</a>.</li></ul></li></ul><p>Use the <a href=https://cloud.google.com/products/calculator>pricing calculator</a> to generate a cost estimate based on your projected usage.</p><h2 id=before-you-begin>Before you begin
<a href=#before-you-begin class=h-anchor aria-hidden=true>#</a></h2><p>This guide assumes that you have owner IAM permissions for your Google Cloud project. In production, you do not require owner permission.</p><ol><li><p><a href=https://console.cloud.google.com/projectselector2>Select or create a Google Cloud project</a>.</p></li><li><p><a href=https://cloud.google.com/billing/docs/how-to/modify-project>Verify that billing is enabled</a> for your project.</p></li></ol><h2 id=set-up-your-environment>Set up your environment
<a href=#set-up-your-environment class=h-anchor aria-hidden=true>#</a></h2><p>Initialize the common variables used throughout this tutorial:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>PROJECT_ID<span style=color:#f92672>=</span>FIXME-WITH-YOUR-PROJECT-ID
</span></span><span style=display:flex><span>REGION<span style=color:#f92672>=</span>us-east5
</span></span><span style=display:flex><span>ZONE<span style=color:#f92672>=</span>us-east5-a
</span></span></code></pre></div><p>To avoid repeating the <code>--project</code> in the commands throughout this tutorial, let&rsquo;s set the current project:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gcloud config set project <span style=color:#e6db74>${</span>PROJECT_ID<span style=color:#e6db74>}</span>
</span></span></code></pre></div><h2 id=enable-the-required-apis-in-your-project>Enable the required APIs in your project
<a href=#enable-the-required-apis-in-your-project class=h-anchor aria-hidden=true>#</a></h2><p>Enable the required APIs in your project:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gcloud services enable <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    spanner.googleapis.com <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    container.googleapis.com
</span></span></code></pre></div><h2 id=create-a-gke-cluster>Create a GKE cluster
<a href=#create-a-gke-cluster class=h-anchor aria-hidden=true>#</a></h2><p>Create a GKE cluster with Workload Identity enabled:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>CLUSTER<span style=color:#f92672>=</span>spanner-with-onlineboutique
</span></span><span style=display:flex><span>gcloud container clusters create <span style=color:#e6db74>${</span>CLUSTER<span style=color:#e6db74>}</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --zone <span style=color:#e6db74>${</span>ZONE<span style=color:#e6db74>}</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --machine-type<span style=color:#f92672>=</span>e2-standard-4 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --num-nodes <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --workload-pool <span style=color:#e6db74>${</span>PROJECT_ID<span style=color:#e6db74>}</span>.svc.id.goog
</span></span></code></pre></div><h2 id=provision-a-spanner-database>Provision a Spanner database
<a href=#provision-a-spanner-database class=h-anchor aria-hidden=true>#</a></h2><p>Provision the Spanner instance:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>SPANNER_REGION_CONFIG<span style=color:#f92672>=</span>regional-<span style=color:#e6db74>${</span>REGION<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>SPANNER_INSTANCE_NAME<span style=color:#f92672>=</span>onlineboutique
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gcloud spanner instances create <span style=color:#e6db74>${</span>SPANNER_INSTANCE_NAME<span style=color:#e6db74>}</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --description<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;online boutique shopping cart&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --instance-type free-instance <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --config <span style=color:#e6db74>${</span>SPANNER_REGION_CONFIG<span style=color:#e6db74>}</span>
</span></span></code></pre></div><p><em>Notes: with the latest version of gcloud we are able to provision a <a href=https://cloud.google.com/blog/products/spanner/try-cloud-spanner-databases>free Spanner instance</a>.</em></p><p>Provision the Spanner database:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>SPANNER_DATABASE_NAME<span style=color:#f92672>=</span>carts
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gcloud spanner databases create <span style=color:#e6db74>${</span>SPANNER_DATABASE_NAME<span style=color:#e6db74>}</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --instance <span style=color:#e6db74>${</span>SPANNER_INSTANCE_NAME<span style=color:#e6db74>}</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --database-dialect GOOGLE_STANDARD_SQL <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --ddl <span style=color:#e6db74>&#34;CREATE TABLE CartItems (userId STRING(1024), productId STRING(1024), quantity INT64) PRIMARY KEY (userId, productId); CREATE INDEX CartItemsByUserId ON CartItems(userId);&#34;</span>
</span></span></code></pre></div><h2 id=grant-the-cartservices-service-account-access-to-the-spanner-database>Grant the <code>cartservice</code>&rsquo;s service account access to the Spanner database
<a href=#grant-the-cartservices-service-account-access-to-the-spanner-database class=h-anchor aria-hidden=true>#</a></h2><p>Create a dedicated least privilege Google Service Account to allow the <code>cartservice</code>&rsquo;s Kubernetes Service Account to communicate with the Spanner database:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>SPANNER_DB_USER_GSA_NAME<span style=color:#f92672>=</span>spanner-db-user-sa
</span></span><span style=display:flex><span>SPANNER_DB_USER_GSA_ID<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>SPANNER_DB_USER_GSA_NAME<span style=color:#e6db74>}</span>@<span style=color:#e6db74>${</span>PROJECT_ID<span style=color:#e6db74>}</span>.iam.gserviceaccount.com
</span></span><span style=display:flex><span>ONLINEBOUTIQUE_NAMESPACE<span style=color:#f92672>=</span>onlineboutique
</span></span><span style=display:flex><span>CARTSERVICE_KSA_NAME<span style=color:#f92672>=</span>cartservice
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gcloud iam service-accounts create <span style=color:#e6db74>${</span>SPANNER_DB_USER_GSA_NAME<span style=color:#e6db74>}</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --display-name<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>SPANNER_DB_USER_GSA_NAME<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>gcloud spanner instances add-iam-policy-binding <span style=color:#e6db74>${</span>SPANNER_INSTANCE_NAME<span style=color:#e6db74>}</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --member <span style=color:#e6db74>&#34;serviceAccount:</span><span style=color:#e6db74>${</span>SPANNER_DB_USER_GSA_ID<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --role roles/spanner.databaseUser
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gcloud iam service-accounts add-iam-policy-binding <span style=color:#e6db74>${</span>SPANNER_DB_USER_GSA_ID<span style=color:#e6db74>}</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --member <span style=color:#e6db74>&#34;serviceAccount:</span><span style=color:#e6db74>${</span>PROJECT_ID<span style=color:#e6db74>}</span><span style=color:#e6db74>.svc.id.goog[</span><span style=color:#e6db74>${</span>ONLINEBOUTIQUE_NAMESPACE<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>${</span>CARTSERVICE_KSA_NAME<span style=color:#e6db74>}</span><span style=color:#e6db74>]&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --role roles/iam.workloadIdentityUser
</span></span></code></pre></div><h2 id=deploy-online-boutique-connected-to-the-spanner-database>Deploy Online Boutique connected to the Spanner database
<a href=#deploy-online-boutique-connected-to-the-spanner-database class=h-anchor aria-hidden=true>#</a></h2><p>To automate the deployment of Online Boutique integrated with Spanner we will leverage the associated Kustomize overlays.</p><p>Define the Kustomize manifest:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF&gt; kustomization.yaml
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: kustomize.config.k8s.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: Kustomization
</span></span></span><span style=display:flex><span><span style=color:#e6db74>resources:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- github.com/GoogleCloudPlatform/microservices-demo/kustomize/base
</span></span></span><span style=display:flex><span><span style=color:#e6db74>components:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- github.com/GoogleCloudPlatform/microservices-demo/kustomize/components/service-accounts
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- spanner
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>mkdir spanner
</span></span><span style=display:flex><span>curl -L https://raw.githubusercontent.com/GoogleCloudPlatform/microservices-demo/main/kustomize/components/spanner/kustomization.yaml &gt; spanner/kustomization.yaml
</span></span></code></pre></div><p>Update the Kustomize manifest to target this specific Spanner database.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sed -i <span style=color:#e6db74>&#34;s/SPANNER_PROJECT/</span><span style=color:#e6db74>${</span>PROJECT_ID<span style=color:#e6db74>}</span><span style=color:#e6db74>/g&#34;</span> spanner/kustomization.yaml
</span></span><span style=display:flex><span>sed -i <span style=color:#e6db74>&#34;s/SPANNER_INSTANCE/</span><span style=color:#e6db74>${</span>SPANNER_INSTANCE_NAME<span style=color:#e6db74>}</span><span style=color:#e6db74>/g&#34;</span> spanner/kustomization.yaml
</span></span><span style=display:flex><span>sed -i <span style=color:#e6db74>&#34;s/SPANNER_DATABASE/</span><span style=color:#e6db74>${</span>SPANNER_DATABASE_NAME<span style=color:#e6db74>}</span><span style=color:#e6db74>/g&#34;</span> spanner/kustomization.yaml
</span></span><span style=display:flex><span>sed -i <span style=color:#e6db74>&#34;s/SPANNER_DB_USER_GSA_ID/</span><span style=color:#e6db74>${</span>SPANNER_DB_USER_GSA_ID<span style=color:#e6db74>}</span><span style=color:#e6db74>/g&#34;</span> spanner/kustomization.yaml
</span></span></code></pre></div><p>Deploy the Online Boutique sample apps:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create namespace <span style=color:#e6db74>${</span>ONLINEBOUTIQUE_NAMESPACE<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>kubectl apply <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -k . <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -n <span style=color:#e6db74>${</span>ONLINEBOUTIQUE_NAMESPACE<span style=color:#e6db74>}</span>
</span></span></code></pre></div><p>After all the apps have successfully been deployed, you could navigate to the Online Boutique website by clicking on the link below:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo -n <span style=color:#e6db74>&#34;http://&#34;</span> <span style=color:#f92672>&amp;&amp;</span> kubectl get svc frontend-external -n <span style=color:#e6db74>${</span>ONLINEBOUTIQUE_NAMESPACE<span style=color:#e6db74>}</span> -o json | jq -r <span style=color:#e6db74>&#39;.status.loadBalancer.ingress[0].ip&#39;</span>
</span></span></code></pre></div><p>From the Online Boutique websiste, you can add some products in your shopping cart and then you can click on the link below to see all the data serialized in the Spanner database by you and the <code>loadgenerator</code> app:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo -e <span style=color:#e6db74>&#34;https://console.cloud.google.com/spanner/instances/</span><span style=color:#e6db74>${</span>SPANNER_INSTANCE_NAME<span style=color:#e6db74>}</span><span style=color:#e6db74>/databases/</span><span style=color:#e6db74>${</span>SPANNER_DATABASE_NAME<span style=color:#e6db74>}</span><span style=color:#e6db74>/tables/CartItems/details/data?project=</span><span style=color:#e6db74>${</span>PROJECT_ID<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><p>And voilà, that&rsquo;s how easy you can connect your Online Boutique sample apps to a Spanner database, congrats!</p><h2 id=cleaning-up>Cleaning up
<a href=#cleaning-up class=h-anchor aria-hidden=true>#</a></h2><p>To avoid incurring charges to your Google Cloud account, you can delete the resources used in this tutorial.</p><p>Delete the GKE cluster:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gcloud container clusters delete <span style=color:#e6db74>${</span>CLUSTER<span style=color:#e6db74>}</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --zone <span style=color:#e6db74>${</span>ZONE<span style=color:#e6db74>}</span>
</span></span></code></pre></div><p>Delete the Spanner database:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gcloud spanner instances delete <span style=color:#e6db74>${</span>SPANNER_INSTANCE_NAME<span style=color:#e6db74>}</span>
</span></span></code></pre></div><h2 id=conclusion>Conclusion
<a href=#conclusion class=h-anchor aria-hidden=true>#</a></h2><p>Having the database outside of your GKE cluster with a managed service can bring you more resiliency and security, and with this new Cloud Spanner option the Online Boutique will become more highly available. This setup allows complex scenarios like having your apps spreaded across multiple clusters, etc.</p><p>Thanks to the original implementation of <a href=https://www.linkedin.com/in/%F0%9F%8C%8Ddaniel-quinlan-51126016/>Daniel Quinlan</a>, this new Spanner option is now available to everyone in the Online Boutique GitHub repository, feel free to <a href=https://github.com/GoogleCloudPlatform/microservices-demo/tree/main/kustomize/components/spanner>give it a try</a>!</p><p>Happy sailing, cheers!</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://mathieu-benoit.github.io/posts/2022/10/grpc-health-probes/><span class=button__icon>←</span>
<span class=button__text>grpc health probes with kubernetes 1.24+</span></a></span>
<span class="button next"><a href=https://mathieu-benoit.github.io/posts/2022/09/gatekeeper-policies-as-oci-artifacts/><span class=button__text>deploying gatekeeper policies as oci artifacts, the gitops way</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>always up, always on</span>
<span class=logo__cursor></span></a><div class=copyright><span>© 2024 Powered by
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span>
<span>Theme created by
<a href=https://twitter.com/panr target=_blank rel=noopener>panr</a></span></div></div></footer><script src=https://mathieu-benoit.github.io/assets/main.js></script>
<script src=https://mathieu-benoit.github.io/assets/prism.js></script></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-J8536XT21V"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-J8536XT21V",{anonymize_ip:!1})}</script></body></html>