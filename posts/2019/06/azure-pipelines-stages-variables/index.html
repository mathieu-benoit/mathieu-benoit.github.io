<!doctype html><html lang=en><head><title>set a multi-stage output variable with azure devops ::
always up, always on</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Update on May 4th, 2020: Azure DevOps now supports this feature: Jobs can access output variables from previous stages. So you don&amp;rsquo;t need anymore this tips, but could just read this article for fun and to learn few commands with jq ;)
Since I wrote my first Multi-stage YAML Azure Pipelines I played few times with this new capability to have both Build and Release pipelines in one YAML file, I really love it!"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=mathieu-benoit.github.io/posts/2019/06/azure-pipelines-stages-variables/><link rel=stylesheet href=mathieu-benoit.github.io/assets/style.css><link rel=stylesheet href=mathieu-benoit.github.io/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=mathieu-benoit.github.io/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=mathieu-benoit.github.io/img/favicon.png><link href=mathieu-benoit.github.io/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=mathieu-benoit.github.io/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=mathieu-benoit.github.io/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=mathieu-benoit.github.io/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=mathieu-benoit.github.io/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=mathieu-benoit.github.io/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary"><meta name=twitter:title content="set a multi-stage output variable with azure devops"><meta name=twitter:description content="let's see how to easily pass variables from one stage to another in azure devops pipelines"><meta property="og:title" content="set a multi-stage output variable with azure devops"><meta property="og:description" content="let's see how to easily pass variables from one stage to another in azure devops pipelines"><meta property="og:type" content="article"><meta property="og:url" content="mathieu-benoit.github.io/posts/2019/06/azure-pipelines-stages-variables/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-06-09T00:00:00+00:00"><meta property="article:modified_time" content="2019-06-09T00:00:00+00:00"><meta property="og:site_name" content="always up, always on"><script async src="https://www.googletagmanager.com/gtag/js?id=G-J8536XT21V"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-J8536XT21V",{anonymize_ip:!1})}</script></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>always up, always on</span>
<span class=logo__cursor></span></a>
<span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=mathieu-benoit.github.io/about/>about</a></li><li><a href=mathieu-benoit.github.io/presentations/>presentations</a></li><li><a href=mathieu-benoit.github.io/tags/>tags</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=mathieu-benoit.github.io/about/>about</a></li><li><a href=mathieu-benoit.github.io/presentations/>presentations</a></li><li><a href=mathieu-benoit.github.io/tags/>tags</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h1 class=post-title>set a multi-stage output variable with azure devops</h1><div class=post-meta><span class=post-date>2019-06-09</span></div><span class=post-tags><a href=mathieu-benoit.github.io/tags/azure-devops/>#azure-devops</a>&nbsp;</span><div class=post-content><p><em>Update on May 4th, 2020: Azure DevOps now supports this feature: <a href=https://docs.microsoft.com/azure/devops/release-notes/2020/sprint-168-update#jobs-can-access-output-variables-from-previous-stages>Jobs can access output variables from previous stages</a>. So you don&rsquo;t need anymore this tips, but could just read this article for fun and to learn few commands with <code>jq</code> ;)</em></p><p>Since <a href=https://alwaysupalwayson.blogspot.com/2019/05/i-wrote-my-first-multi-stage-yaml-azure.html>I wrote my first Multi-stage YAML Azure Pipelines</a> I played few times with this new capability to have both Build and Release pipelines in one YAML file, I really love it!</p><p>One of the limitation I have found is it&rsquo;s not possible to create/write/pass variables from one Stage to another Stage, but <a href="https://docs.microsoft.com/azure/devops/pipelines/process/variables?view=azure-devops&tabs=yaml%2Cbatch#set-a-multi-job-output-variable">it&rsquo;s possible from one Job to another Job within one Stage</a>.<br>Donovan Brown recently proposed one way to do that: <a href=http://donovanbrown.com/post/Passing-variables-from-stage-to-stage-in-Azure-DevOps-release>Passing variables from stage to stage in Azure DevOps release</a>. Furthermore, still on the same track, Stephan Stranger recently wrote <a href=https://stefanstranger.github.io/2019/06/26/PassingVariablesfromStagetoStage>Passing variables from stage to stage in Azure DevOps Release Pipelines</a> too.<br>Interesting, but&mldr; to be honest I was looking for something lighter and easier to setup and maintain.</p><p>After a quick chat with my colleague <a href=https://www.linkedin.com/in/cwiederspan>Chris Wiederspan</a>, we came with the idea to leverage the <a href=https://docs.microsoft.com/azure/devops/pipelines/artifacts/pipeline-artifacts>Artifacts within Azure pipelines</a> (not <a href=https://azure.microsoft.com/services/devops/artifacts>Azure Artifacts</a>). So typically creating a file with key/value pairs in it and then shared across Stages.</p><p>And here is how I was able to accomplish that with an Ubuntu agent to play a little bit with <code>jq</code>:</p><h1 id=stage-1>Stage 1
<a href=#stage-1 class=h-anchor aria-hidden=true>#</a></h1><pre tabindex=0><code>- bash: |
 echo $(jq -n --arg jqVar &#34;$(oneAdoVariable)&#34; &#39;{yourVariableToShare: $jqVar}&#39;) &gt; $(build.artifactStagingDirectory)/variables.json
- publish: $(build.artifactStagingDirectory)
 artifact: yourartifact
</code></pre><p><em>Note: &ldquo;$(oneAdoVariable)&rdquo; could be replaced by either &ldquo;yourvalue&rdquo; or &ldquo;$oneBashVariable&rdquo;, depending on your use case.</em></p><h1 id=stage-2n>Stage 2..n
<a href=#stage-2n class=h-anchor aria-hidden=true>#</a></h1><pre tabindex=0><code>- download: current  
 artifact: yourartifact  
- bash: |  
 valueOfYourVariableShared=$(jq .yourVariableToShare $(pipeline.workspace)/yourartifact/variables.json -r)  
</code></pre><p>Not that complicated, isn&rsquo;t it? Hope you could leverage this approach for your own needs.</p><p>Cheers!</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=mathieu-benoit.github.io/posts/2019/06/keda/><span class=button__icon>←</span>
<span class=button__text>keda, event-driven containers for Kubernetes</span></a></span>
<span class="button next"><a href=mathieu-benoit.github.io/posts/2019/05/azure-security/><span class=button__text>security with microsoft azure</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>always up, always on</span>
<span class=logo__cursor></span></a><div class=copyright><span>© 2023 Powered by
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span>
<span>Theme created by
<a href=https://twitter.com/panr target=_blank rel=noopener>panr</a></span></div></div></footer><script src=mathieu-benoit.github.io/assets/main.js></script>
<script src=mathieu-benoit.github.io/assets/prism.js></script></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-J8536XT21V"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-J8536XT21V",{anonymize_ip:!1})}</script></body></html>