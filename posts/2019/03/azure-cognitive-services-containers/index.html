<!doctype html><html lang=en><head><title>deploying azure cognitive services as docker containers ::
always up, always on</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Azure Cognitive Services is a set of APIs, SDKs and container images that enables developers to integrate ready-made AI directly into their applications. Azure Cognitive Services contains a broad set of capabilities including text analytics; facial detection, speech and vision recognition; natural language understanding, and more. Container support in Azure Cognitive Services allow developers to use the same rich APIs that are available in Azure but with the flexibility that comes with containers."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://mathieu-benoit.github.io/posts/2019/03/azure-cognitive-services-containers/><link rel=stylesheet href=https://mathieu-benoit.github.io/assets/style.css><link rel=stylesheet href=https://mathieu-benoit.github.io/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://mathieu-benoit.github.io/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://mathieu-benoit.github.io/img/favicon.png><link href=https://mathieu-benoit.github.io/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://mathieu-benoit.github.io/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://mathieu-benoit.github.io/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://mathieu-benoit.github.io/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://mathieu-benoit.github.io/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://mathieu-benoit.github.io/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary"><meta name=twitter:title content="deploying azure cognitive services as docker containers"><meta name=twitter:description content="let's deploy azure cognitive services as docker containers"><meta property="og:title" content="deploying azure cognitive services as docker containers"><meta property="og:description" content="let's deploy azure cognitive services as docker containers"><meta property="og:type" content="article"><meta property="og:url" content="https://mathieu-benoit.github.io/posts/2019/03/azure-cognitive-services-containers/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-03-31T00:00:00+00:00"><meta property="article:modified_time" content="2019-03-31T00:00:00+00:00"><meta property="og:site_name" content="always up, always on"><script async src="https://www.googletagmanager.com/gtag/js?id=G-J8536XT21V"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-J8536XT21V",{anonymize_ip:!1})}</script></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>always up, always on</span>
<span class=logo__cursor></span></a>
<span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about/>about</a></li><li><a href=/presentations/>presentations</a></li><li><a href=/tags/>tags</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about/>about</a></li><li><a href=/presentations/>presentations</a></li><li><a href=/tags/>tags</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h1 class=post-title>deploying azure cognitive services as docker containers</h1><div class=post-meta><span class=post-date>2019-03-31</span></div><span class=post-tags><a href=https://mathieu-benoit.github.io/tags/azure/>#azure</a>&nbsp;
<a href=https://mathieu-benoit.github.io/tags/containers/>#containers</a>&nbsp;
<a href=https://mathieu-benoit.github.io/tags/ai/>#ai</a>&nbsp;</span><div class=post-content><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/hdfbn4Q8jbo style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="Bringing AI to the edge: Azure Cognitive Services in Containers"></iframe></div><blockquote><p><em><a href=https://aka.ms/cognitive-services>Azure Cognitive Services</a> is a set of APIs, SDKs and container images that enables developers to integrate ready-made AI directly into their applications. Azure Cognitive Services contains a broad set of capabilities including text analytics; facial detection, speech and vision recognition; natural language understanding, and more.
Container support in Azure Cognitive Services allow developers to use the same rich APIs that are available in Azure but with the flexibility that comes with containers. See <a href=http://aka.ms/cognitive-services-containers>Container support in Azure Cognitive Services</a> for details.</em></p></blockquote><p>As we speak only LUIS, Key Phrase Extraction (Text), Language Detection (Text) and Sentiment Analysis (Text) are in Public Preview with Containers. Recognize Text (Computer Vision) and Face are in Private Preview, you could request access.</p><p>FYI here are the size of the Docker images as for today:</p><ul><li><code>mcr.microsoft.com/azure-cognitive-services/sentiment</code> - 1.45GB</li><li><code>mcr.microsoft.com/azure-cognitive-services/keyphrase</code> - 1.25GB</li><li><code>mcr.microsoft.com/azure-cognitive-services/language</code> - 0.845GB</li><li><code>mcr.microsoft.com/azure-cognitive-services/luis</code> - 0.474GB</li></ul><p><em>Note: if you need a specific version and not the latest, you could get the list of tags available via the following url (example for the sentiment): <a href=https://mcr.microsoft.com/v2/azure-cognitive-services/sentiment/tags/list>https://mcr.microsoft.com/v2/azure-cognitive-services/sentiment/tags/list</a></em></p><p>Even if you are using Azure Cognitive Services on Containers, you need to provision the Azure service, here, to do so let&rsquo;s do it by Azure CLI:</p><pre tabindex=0><code>$ cs=&lt;your-cs-name&gt;  
$ rg=&lt;your-rg-name&gt;  
$ location=eastus  
$ az cognitiveservices account create -n $cs -g $rg --kind CognitiveServices --sku S0 -l $location --yes  
</code></pre><p>Then we will need the access key and the endpoint to reuse later:</p><pre tabindex=0><code>$ key=$(az cognitiveservices account keys list -n $cs -g $rg --query key1 -o tsv)  
$ endpoint=$(az cognitiveservices account show -n $cs  -g $rg --query endpoint -o tsv)  
</code></pre><p>From there you could run locally your Docker container (sentiment with the example below):</p><pre tabindex=0><code>$ docker run --rm -it -p 5000:5000  mcr.microsoft.com/azure-cognitive-services/sentiment Eula=accept Billing=${endpoint}text/analytics/v2.0 ApiKey=$key
</code></pre><p>You could then test your API here: <a href=http://localhost:5000/swagger/index.html>http://localhost:5000/swagger/index.html</a></p><p>You could also run this container on an Azure Container Instances (ACI):</p><pre tabindex=0><code>aci=&lt;your-aci-name&gt;  
az container create \
    -g $rg \
    -n $aci \
    --image mcr.microsoft.com/azure-cognitive-services/sentiment \
    -e Eula=accept Billing=${endpoint}text/analytics/v2.0 ApiKey=$key \
    --ports 5000 \
    --cpu 1 \
    --memory 4 \
    --ip-address public
</code></pre><p>You will be able to test the same swagger url by replacing localhost by the ACI IP address:</p><pre tabindex=0><code>az container show -g $rg -n $aci --query ipAddress.ip -o tsv
</code></pre><p>You will find more details and all you need to know to run your Container support in Azure Cognitive Services here:</p><ul><li><a href=https://docs.microsoft.com/azure/cognitive-services/text-analytics/how-tos/text-analytics-how-to-install-containers>Install and run containers</a></li><li><a href=https://docs.microsoft.com/azure/cognitive-services/text-analytics/text-analytics-resource-container-config>Configure containers</a></li></ul><p>You will for example see an important information about <a href=https://docs.microsoft.com/azure/cognitive-services/text-analytics/how-tos/text-analytics-how-to-install-containers#connecting-to-azure>billing and the requirement for your Docker container to connect to Azure</a>.</p><p>Another option is to deploy this container in a Kubernetes cluster, let&rsquo;s do it:</p><pre tabindex=0><code>$ deploymentName=sentiment-test
$ kubectl run $deploymentName --image mcr.microsoft.com/azure-cognitive-services/sentiment --port 5000 --env Eula=accept --env ApiKey=$key --env Billing=${endpoint}text/analytics/v2.0
$ kubectl expose deployment $deploymentName --port=5000 --target-port=5000 --type LoadBalancer
</code></pre><p>You will be able to test the same swagger url by replacing localhost by the K8S service&rsquo;s <code>EXTERNAL-IP</code>:</p><pre tabindex=0><code>kubectl get svc $deploymentName
</code></pre><p>If you are looking for a more complete documentation about Azure Cognitive Services on Kubernetes, feel to leverage this official tutorial: <a href=https://docs.microsoft.com/azure/cognitive-services/text-analytics/how-tos/text-analytics-how-to-use-container-instance>How to run on Azure Kubernetes Service</a>.</p><p>Further resources and considerations:</p><ul><li><a href=https://azure.microsoft.com/blog/getting-started-with-azure-cognitive-services-in-containers>Getting started with Azure Cognitive Services in containers</a></li><li><a href=https://azure.microsoft.com/blog/running-cognitive-service-containers>Running Cognitive Service containers</a></li><li><a href=https://azure.microsoft.com/blog/bringing-ai-to-the-edge>Bringing AI to the edge</a></li><li><a href=https://aka.ms/AI-training>Microsoft Professional Program for Artificial Intelligence</a></li></ul><p>Hope you enjoyed this blog article and you will be able to leverage and adapt this for your own needs and context.</p><p>Cheers!</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://mathieu-benoit.github.io/posts/2019/04/windows-k8s-nodes-ga/><span class=button__icon>←</span>
<span class=button__text>windows containers with kubernetes 1.14</span></a></span>
<span class="button next"><a href=https://mathieu-benoit.github.io/posts/2019/03/azure-pipelines-container-job-for-terraform/><span class=button__text>azure devops pipeline container job with terraform</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>always up, always on</span>
<span class=logo__cursor></span></a><div class=copyright><span>© 2024 Powered by
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span>
<span>Theme created by
<a href=https://twitter.com/panr target=_blank rel=noopener>panr</a></span></div></div></footer><script src=https://mathieu-benoit.github.io/assets/main.js></script>
<script src=https://mathieu-benoit.github.io/assets/prism.js></script></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-J8536XT21V"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-J8536XT21V",{anonymize_ip:!1})}</script></body></html>