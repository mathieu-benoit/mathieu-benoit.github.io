<!doctype html><html lang=en><head><title>windows containers with kubernetes 1.14 ::
always up, always on</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Update on April 28th, 2020: Windows Nodes with Azure Kubernetes Service (AKS) is now GA! ;)
On March 25th, 2019 Kubernetes 1.14 went out! And one of the big news with this new major version is the Windows Server containers now supported and graduated as &amp;lsquo;stable&amp;rsquo; in Kubernetes!
With v1.14, we’re declaring that Windows node support is stable, well-tested, and ready for adoption in production scenarios. This is a huge milestone for many reasons."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/posts/2019/04/windows-k8s-nodes-ga/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/img/favicon.png><link href=/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary"><meta name=twitter:title content="windows containers with kubernetes 1.14"><meta name=twitter:description content="let's see what does mean the graduation of the windows nodes support in k8s as stable"><meta property="og:title" content="windows containers with kubernetes 1.14"><meta property="og:description" content="let's see what does mean the graduation of the windows nodes support in k8s as stable"><meta property="og:type" content="article"><meta property="og:url" content="/posts/2019/04/windows-k8s-nodes-ga/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-04-09T00:00:00+00:00"><meta property="article:modified_time" content="2019-04-09T00:00:00+00:00"><meta property="og:site_name" content="always up, always on"><script async src="https://www.googletagmanager.com/gtag/js?id=G-J8536XT21V"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-J8536XT21V",{anonymize_ip:!1})}</script></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>always up, always on</span>
<span class=logo__cursor></span></a>
<span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about/>about</a></li><li><a href=/presentations/>presentations</a></li><li><a href=/tags/>tags</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about/>about</a></li><li><a href=/presentations/>presentations</a></li><li><a href=/tags/>tags</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h1 class=post-title>windows containers with kubernetes 1.14</h1><div class=post-meta><span class=post-date>2019-04-09</span></div><span class=post-tags><a href=/tags/azure/>#azure</a>&nbsp;
<a href=/tags/containers/>#containers</a>&nbsp;
<a href=/tags/kubernetes/>#kubernetes</a>&nbsp;</span><div class=post-content><p><em>Update on April 28th, 2020: <a href=https://azure.microsoft.com/updates/windows-server-containers-in-aks-now-generally-available>Windows Nodes with Azure Kubernetes Service (AKS) is now GA</a>! ;)</em></p><p>On March 25th, 2019 <a href=https://kubernetes.io/blog/2019/03/25/kubernetes-1-14-release-announcement>Kubernetes 1.14 went out</a>! And one of the big news with this new major version is the <a href=https://kubernetes.io/blog/2019/03/25/kubernetes-1-14-release-announcement>Windows Server containers now supported and graduated as &lsquo;stable&rsquo; in Kubernetes</a>!</p><blockquote><p><em>With v1.14, we’re declaring that Windows node support is stable, well-tested, and ready for adoption in production scenarios. This is a huge milestone for many reasons. For Kubernetes, it strengthens its position in the industry, enabling a vast ecosystem of Windows-based applications to be deployed on the platform. For Windows operators and developers, this means they can use the same tools and processes to manage their Windows and Linux workloads, taking full advantage of the efficiencies of the cloud-native ecosystem powered by Kubernetes. <a href=https://kubernetes.io/blog/2019/04/01/kubernetes-v1.14-delivers-production-level-support-for-windows-nodes-and-windows-containers/>Let’s dig in a little bit into these</a>.</em></p></blockquote><p>Interesting to see the current <a href=https://kubernetes.io/docs/setup/windows/intro-windows-in-kubernetes/#limitations>limitations</a> and the <a href=https://kubernetes.io/docs/setup/windows/intro-windows-in-kubernetes/#what-s-next>what&rsquo;s coming</a> too.</p><p><em>[Update - 2019-04-24 - The <a href=https://www.cncf.io/community/webinars/kubernetes-1-14-release/>What&rsquo;s new in Kubernetes 1.14? webinar</a> is now available]</em></p><p>Now, how to easily get started and deploy your first Kubernetes cluster with Windows Server Nodes? While Azure Kubernetes Service (AKS) doesn&rsquo;t support it yet <em>[Update - 2019-05-17 - <a href=https://azure.microsoft.com/en-us/blog/announcing-the-preview-of-windows-server-containers-support-in-azure-kubernetes-service>AKS supports it now in Public Preview</a>! ;)]</em>, an easy way in Azure is to leverage AKS-Engine. To get started with AKS-Engine, you could follow this <a href=https://github.com/Azure/aks-engine/blob/master/docs/tutorials/quickstart.md>quickstart guide</a>. Furthermore, you could follow the information and instructions of this <a href=https://github.com/Azure/aks-engine/blob/master/docs/topics/windows.md>Kubernetes Windows Walkthrough</a>.</p><p>Let&rsquo;s do it! You could <a href=https://github.com/Azure/aks-engine/tree/master/examples/windows>choose one of the examples</a>. Or <a href=https://github.com/mathieu-benoit/aksengine-agent/blob/master/example/kubernetes-win-vmss.json>download my example</a> for provisioning 1 Master Node (Linux) and 1 Agent Node (Windows) with Kubernetes 1.14. Then run this command:</p><pre tabindex=0><code>aks-engine deploy -s $subscriptionId \
    --client-id &#39;$clientId&#39; \
    --client-secret &#39;$clientSecret&#39; \
    --dns-prefix $dnsPrefix \
    -l $location \
    --api-model kubernetes-win-vmss.json
</code></pre><p>Once your deployment is done, you could run this command below to get more information about the nodes actually deployed:</p><pre tabindex=0><code>kubectl get nodes \
    -o wide \
    --kubeconfig output/kubeconfig/kubeconfig.$location.json  
NAME                    STATUS   ROLES    AGE     VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE                    KERNEL-VERSION      CONTAINER-RUNTIME  
2405k8s00000000         Ready    agent    5h13m   v1.14.1   10.240.0.4     &lt;none&gt;        Windows Server Datacenter   10.0.17763.379      docker://18.9.2  
k8s-master-24055217-0   Ready    master   5h15m   v1.14.1   10.255.255.5   &lt;none&gt;        Ubuntu 16.04.6 LTS          4.15.0-1041-azure   docker://3.0.4  
</code></pre><p>Now let&rsquo;s deploy an IIS image and expose it via a LoadBalancer and a Public IP:</p><pre tabindex=0><code>kubectl run iis \
    --image mcr.microsoft.com/windows/servercore/iis:windowsservercore-ltsc2019 \
    --port 80 \
    --kubeconfig output/kubeconfig/kubeconfig.$location.json  
kubectl expose deployment iis \
    --port 80 \
    --type LoadBalancer \
    --kubeconfig output/kubeconfig/kubeconfig.$location.json  
kubectl get all \
    --kubeconfig output/kubeconfig/kubeconfig.$location.json  
</code></pre><p><em>Note: if you are using a Multiple Node Pools cluster, you will need to use <code>nodeAffinity</code> or <code>nodeSelector</code> while doing your <code>Deployment</code>.</em></p><p>Then you will be able to enter the pod to do a validation: <code>kubectl exec -it &lt;pod-name> -- cmd</code>.</p><p>Or you will be able to browse the Public IP:</p><pre tabindex=0><code>curl http://$(kubectl get svc iis -o jsonpath=&#34;{.status.loadBalancer.ingress[*].ip}&#34; --kubeconfig output/kubeconfig/kubeconfig.$location.json)
</code></pre><p><em>Note: it won&rsquo;t work as expected for now with VMSS, <a href=https://github.com/Azure/aks-engine/issues/809>there is a known issue about that</a>. In my case it works because I&rsquo;m using VMAS (AvailabilitySet) for the Agent Nodes.</em></p><p>If you would like to build your own Windows containers, feel free to leverage <a href=https://docs.docker.com/docker-for-windows>Docker for Windows</a> locally, <a href=https://docs.microsoft.com/azure/container-registry/container-registry-tasks-overview>Azure Container Registry Build task</a> (which supports Windows and Linux) or even <a href="https://docs.microsoft.com/azure/devops/pipelines/agents/hosted?view=azure-devops&tabs=yaml#use-a-microsoft-hosted-agent">Azure DevOps with it Microsoft-hosted agents</a> supporting Windows Containers.</p><p><em>Note: in the meantime Azure App Service <a href=https://azure.microsoft.com/blog/windows-server-2019-support-now-available-for-windows-containers-on-azure-app-service>recently got an update with the support of Windows Server 2019 for its Windows Containers in Public Preview</a>. We could learn for example:</em></p><blockquote><p><em>Windows Server Core 2019 LTSC base image is 4.28 GB compared to the Windows Server Core 2016 LTSC image is 11GB, which equates to a decrease of 61 percent!</em></p></blockquote><p><em>[Update - 2019-05-06: <a href=https://azure.microsoft.com/updates/azure-container-instances-windows-server-2019-container-support-is-now-in-preview>Azure Container Instances Windows Server 2019 container support is now in preview</a>]</em></p><p>Resources:</p><ul><li><a href=https://myignite.techcommunity.microsoft.com/sessions/65919>From Ops to DevOps with Windows Server containers and Windows Server 2019</a> at Ignite 2018</li><li><a href=https://myignite.techcommunity.microsoft.com/sessions/65885>Getting started with Windows Server containers in Windows Server 2019</a> at Ignite 2018</li><li><a href=https://myignite.techcommunity.microsoft.com/sessions/65918>Take the next step with Windows Server container orchestration</a> at Ignite 2018</li><li><a href=https://docs.microsoft.com/virtualization/windowscontainers/manage-docker/optimize-windows-dockerfile>Optimize Windows Dockerfiles</a></li><li><a href=https://docs.microsoft.com/virtualization/windowscontainers/kubernetes/getting-started-kubernetes-windows>Kubernetes on Windows</a></li><li>You will also find few sessions about <a href=https://alwaysupalwayson.blogspot.com/2018/11/microsoft-at-kubecon-cloudnativecon.html>Windows Containers at KubeCon Shanghai and Seattle 2018</a></li><li><a href=http://stefanscherer.github.io/windows-docker-workshop>Docker on Windows workshop</a></li></ul><p>Hope you enjoyed this blog article and you could leverage it for your own needs.</p><p>Cheers!</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=/posts/2019/05/azure-security/><span class=button__icon>←</span>
<span class=button__text>security with microsoft azure</span></a></span>
<span class="button next"><a href=/posts/2019/03/azure-cognitive-services-containers/><span class=button__text>deploying azure cognitive services as docker containers</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>always up, always on</span>
<span class=logo__cursor></span></a><div class=copyright><span>© 2023 Powered by
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span>
<span>Theme created by
<a href=https://twitter.com/panr target=_blank rel=noopener>panr</a></span></div></div></footer><script src=/assets/main.js></script>
<script src=/assets/prism.js></script></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-J8536XT21V"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-J8536XT21V",{anonymize_ip:!1})}</script></body></html>